# Git 變更檔案打包工具設計文件

## 1. 工具概述

**名稱**：Git 變更檔案打包工具 (create-diff-archive.bat)  
**版本**：1.0  
**開發者**：Robbie Lee  
**最後更新**：2025-04-26  
**用途**：將 Git 儲存庫中兩個分支間的差異檔案打包成單一 ZIP 壓縮檔

## 2. 功能說明

此工具用於自動化以下流程：
- 識別兩個 Git 分支之間的檔案差異
- 提取目標分支中的變更檔案
- 保持原始目錄結構打包成 ZIP 壓縮檔
- 支援中文檔案名稱處理
- 提供詳細的執行報告

適用場景：
- 版本發布前檔案打包
- 提交變更檔案給測試/部署團隊
- 跨環境代碼遷移準備

## 3. 技術架構與工作流程

### 3.1 技術組件

- 批次檔 (Batch Script)
- Git 命令行工具
- PowerShell (用於壓縮及編碼轉換)
- Windows 系統臨時目錄

### 3.2 工作流程

1. **初始化**
   - 檢查環境（Git 儲存庫存在）
   - 處理命令行參數
   
2. **檔案差異分析**
   - 檢查分支是否存在
   - 使用 `git diff-tree` 獲取變更檔案清單
   - 處理編碼問題 (UTF-8 → BIG5)
   
3. **檔案提取**
   - 創建臨時目錄保持原始路徑結構
   - 使用 `git cat-file` 從目標分支提取檔案內容
   - 計數和顯示進度
   
4. **壓縮打包**
   - 使用 PowerShell `Compress-Archive` 創建 ZIP 檔案
   
5. **總結報告**
   - 儲存庫資訊
   - 打包統計資料
   - 輸出文件詳細資訊
   
6. **清理**
   - 移除臨時文件和目錄

## 4. 參數說明

### 4.1 基本參數

| 參數 | 描述 | 預設值 |
|------|------|--------|
| [輸出檔名] | 壓縮檔名稱，自動添加 .zip 副檔名 | APP_SIT.zip |
| [源分支] | 比較的基準分支 | master |
| [目標分支] | 比較的目標分支 | SIT |

### 4.2 具名參數

| 參數 | 描述 | 範例 |
|------|------|------|
| -F | 指定輸出檔名 | -F changes.zip |
| -S | 指定源分支 | -S main |
| -T | 指定目標分支 | -T dev |

## 5. 使用方式

### 5.1 基本用法

```batch
create-diff-archive.bat [輸出檔名] [源分支] [目標分支]
```

### 5.2 具名參數用法

```batch
create-diff-archive.bat -F [輸出檔名] -S [源分支] -T [目標分支]
```

### 5.3 使用範例

```batch
create-diff-archive.bat                       # 使用預設設定
create-diff-archive.bat changes.zip           # 自訂輸出檔名
create-diff-archive.bat -F changes.zip        # 使用具名參數指定輸出檔名
create-diff-archive.bat -S main -T develop    # 自訂源分支和目標分支
```

## 6. 主要功能模組說明

### 6.1 參數處理模組
支援兩種參數形式：位置參數和具名參數，提升使用彈性。

### 6.2 檔案清單獲取
使用 `git diff-tree` 命令獲取兩個分支之間的差異檔案，並過濾只保留添加、修改、重命名和複製的檔案。

### 6.3 檔案提取模組
使用 `git cat-file` 命令安全提取二進制檔案，避免文本轉換問題。

### 6.4 編碼處理
解決中文檔名問題：
- 設定 `git config --local core.quotepath false`
- UTF-8 與 BIG5 編碼轉換

### 6.5 報告生成
提供詳細執行報告，包括:
- Repository 資訊
- 打包統計資料
- 輸出檔案詳情
- 開發資訊與說明

## 7. 限制與注意事項

1. 需在 Git 存儲庫根目錄執行
2. 依賴 Git 和 PowerShell 環境
3. 需有足夠臨時目錄空間
4. 若提取大量檔案可能需要較長時間

## 8. 錯誤處理

工具提供以下錯誤處理機制：
- 檢查 Git 存儲庫環境
- 檢查分支存在性
- 檔案清單是否為空
- 檔案提取失敗提示
- 工作區未提交變更提示

## 9. 未來改進方向

1. 支援篩選特定類型的檔案
2. 添加詳細的 Log 記錄機制
3. 增加多執行緒處理提高效能
4. 提供進度條顯示
5. 添加 GUI 介面選項

---

**備註**: 此設計文件根據工具當前版本整理，實際使用時請參考最新版本的說明。